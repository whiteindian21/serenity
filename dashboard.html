<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Therapathy - AI Healing Companion</title>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700;800&family=Merriweather:wght@300;400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    :root {
      --primary: #5E60CE;
      --primary-light: #E0E1FF;
      --primary-dark: #4A4DC7;
      --secondary: #64DFDF;
      --accent: #FF6B6B;
      --accent-light: #FFD8D8;
      --dark: #25274D;
      --light: #F8F9FF;
      --light-alt: #F0F3FF;
      --gray: #8A9BA8;
      --gray-light: #E2E8F0;
      --success: #48BB78;
      --success-light: #C6F6D5;
      --warning: #F6AD55;
      --error: #E53E3E;
      --transition: all 0.3s ease;
      --radius-lg: 24px;
      --radius-md: 16px;
      --radius-sm: 10px;
      --shadow-light: 0 4px 12px rgba(0, 0, 0, 0.05);
      --shadow-medium: 0 6px 18px rgba(0, 0, 0, 0.08);
      --shadow-dark: 0 10px 30px rgba(0, 0, 0, 0.12);
      --safe-area-inset-bottom: env(safe-area-inset-bottom, 0px);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    html {
      scroll-behavior: smooth;
      font-size: 16px;
    }

    body {
      font-family: 'Nunito', -apple-system, BlinkMacSystemFont, sans-serif;
      background-color: var(--light);
      color: var(--dark);
      line-height: 1.6;
      min-height: 100vh;
      -webkit-font-smoothing: antialiased;
      position: relative;
      overflow-x: hidden;
      background: radial-gradient(circle at 20% 30%, rgba(94, 96, 206, 0.05) 0%, transparent 50%),
                  radial-gradient(circle at 80% 70%, rgba(100, 223, 223, 0.05) 0%, transparent 50%);
      padding-bottom: calc(70px + var(--safe-area-inset-bottom));
    }

    h1, h2, h3, h4 {
      font-family: 'Merriweather', serif;
      font-weight: 700;
      line-height: 1.3;
      color: var(--dark);
    }

    p {
      color: var(--gray);
      font-size: 0.95rem;
    }

    .container {
      width: 100%;
      max-width: 100%;
      margin: 0 auto;
      padding: 0 1rem;
      position: relative;
    }

    /* Mobile Header */
    .mobile-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem;
      background: white;
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: var(--shadow-light);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      background: rgba(255, 255, 255, 0.85);
      border-bottom: 1px solid rgba(94, 96, 206, 0.1);
    }
    
    .app-logo {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-weight: 800;
      font-size: 1.2rem;
      color: var(--primary);
      text-shadow: 0 1px 2px rgba(94, 96, 206, 0.1);
    }
    
    .app-logo i {
      font-size: 1.5rem;
      color: var(--primary);
    }
    
    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 700;
      font-size: 1.1rem;
      box-shadow: 0 4px 12px rgba(94, 96, 206, 0.25);
      cursor: pointer;
      transition: var(--transition);
    }

    .user-avatar:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 18px rgba(94, 96, 206, 0.35);
    }

    /* Dashboard Content */
    .dashboard-content {
      padding: 0.5rem;
      position: relative;
      overflow: hidden;
    }

    /* Cards */
    .card {
      background: rgba(255, 255, 255, 0.97);
      border-radius: var(--radius-md);
      padding: 1.5rem;
      margin: 1rem 0;
      position: relative;
      transition: var(--transition);
      border: 1px solid rgba(255, 255, 255, 0.3);
      box-shadow: var(--shadow-light);
      animation: fadeIn 0.7s ease-out;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      background: rgba(255, 255, 255, 0.92);
      overflow: hidden;
    }

    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 5px;
      height: 100%;
      background: linear-gradient(to bottom, var(--primary), var(--secondary));
      border-radius: var(--radius-md) 0 0 var(--radius-md);
    }

    .card:hover {
      box-shadow: var(--shadow-medium);
      transform: translateY(-5px);
    }

    .card h3 {
      font-size: 1.25rem;
      margin-bottom: 0.8rem;
      display: flex;
      align-items: center;
      gap: 0.6rem;
    }

    .card h3 i {
      font-size: 1.1rem;
      color: var(--primary);
      background: var(--primary-light);
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }

    .affirmation-card {
      background: linear-gradient(135deg, rgba(94, 96, 206, 0.08), rgba(100, 223, 223, 0.08));
      border: 1px solid rgba(94, 96, 206, 0.18);
    }

    #affirmation {
      font-size: 1.15rem;
      font-weight: 500;
      color: var(--dark);
      position: relative;
      z-index: 1;
      line-height: 1.6;
      font-style: italic;
      padding: 1rem;
      background: rgba(255, 255, 255, 0.7);
      border-radius: var(--radius-sm);
      border-left: 3px solid var(--primary);
      margin: 1rem 0;
    }

    .card-actions {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.8rem;
      margin-top: 1rem;
    }

    .btn {
      padding: 0.9rem;
      border-radius: var(--radius-md);
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.6rem;
      border: none;
      width: 100%;
      outline: none;
      font-family: 'Nunito', sans-serif;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: white;
      box-shadow: 0 4px 12px rgba(94, 96, 206, 0.35);
    }

    .btn-primary:hover {
      background: linear-gradient(135deg, var(--primary-dark), var(--primary));
      transform: translateY(-3px);
      box-shadow: 0 6px 18px rgba(94, 96, 206, 0.45);
    }

    .btn-secondary {
      background: rgba(94, 96, 206, 0.12);
      color: var(--primary);
      border: 1px solid rgba(94, 96, 206, 0.25);
    }

    .btn-secondary:hover {
      background: rgba(94, 96, 206, 0.18);
      transform: translateY(-3px);
      box-shadow: 0 4px 12px rgba(94, 96, 206, 0.15);
    }

    .btn-accent {
      background: rgba(255, 107, 107, 0.12);
      color: var(--accent);
      border: 1px solid rgba(255, 107, 107, 0.25);
    }

    .btn-accent:hover {
      background: rgba(255, 107, 107, 0.18);
      transform: translateY(-3px);
      box-shadow: 0 4px 12px rgba(255, 107, 107, 0.15);
    }

    .btn-success {
      background: rgba(72, 187, 120, 0.12);
      color: var(--success);
      border: 1px solid rgba(72, 187, 120, 0.25);
    }

    .btn-sm {
      padding: 0.7rem;
      font-size: 0.85rem;
    }

    /* Action Cards */
    .action-cards {
      display: grid;
      grid-template-columns: 1fr;
      gap: 1rem;
      margin: 1.2rem 0;
    }

    @media (min-width: 768px) {
      .action-cards {
        grid-template-columns: 1fr 1fr;
      }
    }

    .action-card {
      background: rgba(255, 255, 255, 0.97);
      border-radius: var(--radius-md);
      padding: 1.5rem;
      transition: var(--transition);
      box-shadow: var(--shadow-light);
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      cursor: pointer;
      position: relative;
      overflow: hidden;
      border: 1px solid rgba(255, 255, 255, 0.3);
      animation: fadeIn 0.8s ease-out;
      height: 100%;
      backdrop-filter: blur(5px);
      -webkit-backdrop-filter: blur(5px);
      background: rgba(255, 255, 255, 0.9);
    }

    .action-card:hover {
      box-shadow: var(--shadow-medium);
      transform: translateY(-8px);
    }

    .action-card i {
      font-size: 1.8rem;
      color: var(--primary);
      margin-bottom: 0.8rem;
      background: rgba(94, 96, 206, 0.12);
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      transition: var(--transition);
    }

    .action-card h3 {
      margin-bottom: 0.6rem;
      color: var(--dark);
      font-size: 1.15rem;
    }

    .action-card p {
      color: var(--gray);
      font-size: 0.9rem;
      margin-bottom: 1.2rem;
      line-height: 1.5;
    }

    .action-card .btn {
      margin-top: auto;
      width: 100%;
    }

    /* Breathing Exercise */
    .breath-container {
      position: relative;
      margin: 1.5rem auto;
      width: 200px;
      height: 200px;
    }
    
    .breath-circle {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 1.4rem;
      font-weight: 700;
      transition: all 1.5s ease-in-out;
      position: absolute;
      top: 0;
      left: 0;
      box-shadow: 0 6px 20px rgba(94, 96, 206, 0.35);
      z-index: 2;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
    }
    
    .breath-circle.pulse {
      animation: pulse 4s infinite alternate;
    }
    
    .breath-visual {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      z-index: 1;
      opacity: 0.3;
      transition: all 1.5s ease-in-out;
      background: radial-gradient(circle, rgba(94, 96, 206, 0.2) 0%, rgba(94, 96, 206, 0) 70%);
    }
    
    .breath-phase {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: rgba(94, 96, 206, 0.1);
      z-index: 0;
      animation: breathPhase 16s infinite linear;
    }
    
    .breath-phase::before,
    .breath-phase::after {
      content: '';
      position: absolute;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: rgba(94, 96, 206, 0.1);
      opacity: 0;
      animation: breathPhase 16s infinite linear;
    }
    
    .breath-phase::before {
      animation-delay: -4s;
    }
    
    .breath-phase::after {
      animation-delay: -8s;
    }
    
    .breath-stats {
      display: flex;
      justify-content: space-around;
      margin: 1.5rem 0;
    }
    
    .breath-stat {
      text-align: center;
    }
    
    .stat-value {
      font-size: 1.5rem;
      font-weight: 800;
      color: var(--primary);
    }
    
    .stat-label {
      font-size: 0.95rem;
      color: var(--gray);
      margin-top: 0.3rem;
      font-weight: 600;
    }
    
    .breath-instruction {
      font-size: 1.2rem;
      margin: 1.5rem 0;
      color: var(--dark);
      font-weight: 600;
      text-align: center;
      padding: 1rem;
      background: rgba(94, 96, 206, 0.08);
      border-radius: var(--radius-sm);
      transition: all 0.5s ease;
      backdrop-filter: blur(5px);
      -webkit-backdrop-filter: blur(5px);
      background: rgba(255, 255, 255, 0.8);
    }
    
    .breath-controls {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.8rem;
      margin-top: 0.8rem;
    }

    /* Memory Section */
    .memory-container {
      display: flex;
      overflow-x: auto;
      gap: 1rem;
      margin-top: 1.5rem;
      padding-bottom: 0.5rem;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
    }
    
    .memory-container::-webkit-scrollbar {
      display: none;
    }
    
    .memory-item {
      flex: 0 0 auto;
      width: 100px;
      height: 100px;
      border-radius: var(--radius-md);
      background: linear-gradient(135deg, rgba(94, 96, 206, 0.12), rgba(100, 223, 223, 0.12));
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--primary);
      font-size: 2rem;
      cursor: pointer;
      transition: var(--transition);
      border: 1px solid rgba(94, 96, 206, 0.2);
      position: relative;
      overflow: hidden;
      box-shadow: var(--shadow-light);
      background-size: cover;
      background-position: center;
    }
    
    .memory-item:hover {
      transform: translateY(-6px);
      box-shadow: var(--shadow-medium);
    }
    
    .memory-item.add-memory {
      background: rgba(255, 255, 255, 0.7);
      border: 2px dashed rgba(94, 96, 206, 0.35);
      color: var(--gray);
    }
    
    .memory-item.add-memory:hover {
      background: rgba(94, 96, 206, 0.12);
      color: var(--primary);
    }
    
    .memory-label {
      position: absolute;
      bottom: 8px;
      left: 0;
      right: 0;
      font-size: 0.75rem;
      text-align: center;
      color: var(--dark);
      padding: 0 5px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      font-weight: 600;
      background: rgba(255, 255, 255, 0.85);
      padding: 4px;
      border-radius: 0 0 var(--radius-sm) var(--radius-sm);
    }
    
    .memory-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      position: absolute;
      top: 0;
      left: 0;
      z-index: -1;
    }
    
    .memory-item.has-image i {
      display: none;
    }
    
    .memory-item.has-image .memory-label {
      background: rgba(0, 0, 0, 0.7);
      color: white;
    }

    /* Mood Tracker */
    .mood-options {
      display: flex;
      overflow-x: auto;
      gap: 0.8rem;
      margin: 1.5rem 0;
      padding-bottom: 0.5rem;
      scrollbar-width: none;
    }
    
    .mood-options::-webkit-scrollbar {
      display: none;
    }

    .mood-option {
      display: flex;
      flex-direction: column;
      align-items: center;
      cursor: pointer;
      padding: 1rem 0.8rem;
      border-radius: var(--radius-md);
      transition: all 0.3s ease;
      background: rgba(255, 255, 255, 0.8);
      border: 1px solid rgba(94, 96, 206, 0.15);
      box-shadow: var(--shadow-light);
      flex: 0 0 auto;
      width: 85px;
      backdrop-filter: blur(5px);
      -webkit-backdrop-filter: blur(5px);
    }

    .mood-option:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow-medium);
    }

    .mood-emoji {
      font-size: 2rem;
      margin-bottom: 0.5rem;
      transition: var(--transition);
    }

    .mood-label {
      font-size: 0.85rem;
      color: var(--gray);
      font-weight: 600;
    }

    .mood-option.selected {
      background: rgba(94, 96, 206, 0.15);
      border: 1px solid rgba(94, 96, 206, 0.35);
      transform: translateY(-5px);
      box-shadow: 0 6px 15px rgba(94, 96, 206, 0.15);
    }

    .mood-option.selected .mood-emoji {
      transform: scale(1.3);
    }

    .quick-actions {
      display: flex;
      gap: 0.8rem;
      margin-top: 1.2rem;
    }

    /* Progress Section */
    .progress-bar {
      height: 12px;
      background: var(--gray-light);
      border-radius: 6px;
      margin: 1.5rem 0;
      overflow: hidden;
      box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .progress-fill {
      height: 100%;
      width: 65%;
      background: linear-gradient(to right, var(--primary), var(--secondary));
      border-radius: 6px;
      transition: width 1s ease;
      box-shadow: 0 2px 8px rgba(94, 96, 206, 0.3);
    }

    .progress-info {
      display: flex;
      justify-content: space-between;
      font-size: 0.9rem;
      color: var(--gray);
      font-weight: 600;
      margin-top: 0.5rem;
    }
    
    /* Progress sources indicator */
    .progress-sources {
      display: flex;
      justify-content: space-between;
      margin-top: 1.5rem;
      gap: 0.8rem;
    }
    
    .progress-source {
      display: flex;
      flex-direction: column;
      align-items: center;
      flex: 1;
    }
    
    .progress-source-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--primary-light);
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 0.5rem;
      color: white;
      font-size: 1.2rem;
      box-shadow: var(--shadow-light);
    }
    
    .progress-source-value {
      font-weight: 800;
      font-size: 1rem;
      color: var(--primary);
    }
    
    .progress-source-label {
      font-size: 0.8rem;
      color: var(--gray);
      text-align: center;
    }

    /* Companion Section */
    .companion-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      gap: 1rem;
      margin-top: 1.2rem;
    }

    .companion-avatar {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 2.5rem;
      box-shadow: 0 6px 18px rgba(94, 96, 206, 0.35);
      transition: transform 0.3s ease;
      border: 3px solid white;
    }
    
    .companion-avatar:hover {
      transform: scale(1.1);
      box-shadow: 0 8px 25px rgba(94, 96, 206, 0.45);
    }

    .companion-name {
      font-weight: 800;
      font-size: 1.4rem;
      color: var(--dark);
    }

    .companion-role {
      font-size: 1rem;
      color: var(--gray);
      margin-bottom: 0.5rem;
      font-weight: 600;
    }

    .companion-specialties {
      display: flex;
      gap: 0.6rem;
      margin-bottom: 1.2rem;
      flex-wrap: wrap;
      justify-content: center;
    }

    .specialty-tag {
      background: rgba(94, 96, 206, 0.12);
      color: var(--primary);
      padding: 0.5rem 1rem;
      border-radius: 30px;
      font-size: 0.9rem;
      font-weight: 700;
      border: 1px solid rgba(94, 96, 206, 0.25);
      transition: var(--transition);
      box-shadow: var(--shadow-light);
    }
    
    .specialty-tag:hover {
      background: rgba(94, 96, 206, 0.2);
      transform: translateY(-3px);
      box-shadow: var(--shadow-medium);
    }

    /* Bottom Navigation */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: white;
      border-top: 1px solid var(--gray-light);
      display: flex;
      justify-content: space-around;
      padding: 0.8rem 0;
      z-index: 100;
      box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.08);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      background: rgba(255, 255, 255, 0.9);
      padding-bottom: calc(0.8rem + var(--safe-area-inset-bottom));
    }
    
    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      color: var(--gray);
      font-size: 0.8rem;
      text-decoration: none;
      transition: var(--transition);
      flex: 1;
      padding: 0.3rem;
    }
    
    .nav-item i {
      font-size: 1.3rem;
      margin-bottom: 0.3rem;
    }
    
    .nav-item.active {
      color: var(--primary);
    }
    
    .nav-item:hover {
      transform: translateY(-4px);
      color: var(--primary);
    }
    
    .nav-item .nav-label {
      font-weight: 600;
    }

    /* Animations */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes pulse {
      0% {
        transform: scale(0.95);
        box-shadow: 0 0 0 0 rgba(94, 96, 206, 0.45);
      }
      70% {
        transform: scale(1);
        box-shadow: 0 0 0 15px rgba(94, 96, 206, 0);
      }
      100% {
        transform: scale(0.95);
        box-shadow: 0 0 0 0 rgba(94, 96, 206, 0);
      }
    }
    
    @keyframes breathPhase {
      0% { transform: scale(0.8); opacity: 0; }
      12.5% { transform: scale(1.2); opacity: 0.8; }
      25% { transform: scale(1.5); opacity: 0; }
      100% { transform: scale(1.5); opacity: 0; }
    }
    
    .fade-in {
      animation: fadeIn 0.6s ease forwards;
    }
    
    /* Toast Notification */
    .toast {
      position: fixed;
      bottom: 1.2rem;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: var(--dark);
      color: white;
      padding: 1rem 1.5rem;
      border-radius: var(--radius-md);
      font-size: 1rem;
      font-weight: 600;
      box-shadow: var(--shadow-dark);
      z-index: 3000;
      opacity: 0;
      transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      max-width: 90%;
      text-align: center;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      background: rgba(37, 39, 77, 0.95);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .toast.show {
      transform: translateX(-50%) translateY(0);
      opacity: 1;
    }
    
    .toast.success {
      background: rgba(72, 187, 120, 0.95);
    }
    
    .toast.error {
      background: rgba(229, 62, 62, 0.95);
    }
    
    .toast.info {
      background: rgba(94, 96, 206, 0.95);
    }

    /* Login Prompt */
    .login-prompt {
      background: white;
      border-radius: var(--radius-md);
      padding: 2.5rem 1.5rem;
      text-align: center;
      max-width: 500px;
      margin: 2rem auto;
      box-shadow: var(--shadow-light);
      border: 1px solid var(--gray-light);
      animation: fadeIn 0.8s ease-out;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      background: rgba(255, 255, 255, 0.92);
    }
    
    .login-prompt h2 {
      color: var(--primary);
      margin-bottom: 1.2rem;
      font-size: 1.6rem;
    }
    
    .login-prompt p {
      margin-bottom: 1.8rem;
      color: var(--gray);
      font-size: 1.05rem;
      line-height: 1.7;
    }
    
    .btn-login {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: white;
      border: none;
      padding: 1.2rem 2.5rem;
      border-radius: var(--radius-md);
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      font-size: 1.1rem;
      display: inline-flex;
      align-items: center;
      gap: 0.8rem;
      box-shadow: var(--shadow-medium);
      font-family: 'Nunito', sans-serif;
      width: 100%;
      max-width: 300px;
      margin: 0 auto;
      justify-content: center;
    }
    
    .btn-login:hover {
      transform: translateY(-3px);
      box-shadow: var(--shadow-dark);
    }

    /* Sign out button */
    .btn-signout {
      background: none;
      border: none;
      color: var(--gray);
      font-size: 1.1rem;
      cursor: pointer;
      transition: var(--transition);
      padding: 0.5rem 1rem;
      border-radius: var(--radius-md);
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .btn-signout:hover {
      color: var(--primary);
      background: rgba(94, 96, 206, 0.12);
    }
    
    /* Modal styles */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      z-index: 2000;
      justify-content: center;
      align-items: center;
      backdrop-filter: blur(5px);
    }
    
    .modal-content {
      background: white;
      border-radius: var(--radius-lg);
      padding: 2.5rem;
      width: 90%;
      max-width: 500px;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: var(--shadow-dark);
      animation: scaleIn 0.3s ease-out;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      background: rgba(255, 255, 255, 0.95);
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.8rem;
    }
    
    .close-modal {
      background: none;
      border: none;
      font-size: 1.8rem;
      color: var(--gray);
      cursor: pointer;
      transition: var(--transition);
    }
    
    .close-modal:hover {
      color: var(--primary);
    }
    
    .form-group {
      margin-bottom: 1.5rem;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 0.6rem;
      font-weight: 600;
      color: var(--dark);
    }
    
    .form-control {
      width: 100%;
      padding: 1rem;
      border-radius: var(--radius-md);
      border: 1px solid var(--gray-light);
      font-family: 'Nunito', sans-serif;
      font-size: 1rem;
      transition: var(--transition);
      background: white;
    }
    
    .form-control:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(94, 96, 206, 0.2);
    }
    
    .btn-save {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: white;
      border: none;
      padding: 1.2rem;
      border-radius: var(--radius-md);
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      font-size: 1.1rem;
      width: 100%;
      margin-top: 1.5rem;
    }
    
    .btn-save:hover {
      transform: translateY(-3px);
      box-shadow: var(--shadow-dark);
    }
    
    .memory-form input[type="file"] {
      display: none;
    }
    
    .memory-label-upload {
      display: block;
      padding: 1.2rem;
      background: rgba(94, 96, 206, 0.1);
      border-radius: var(--radius-md);
      text-align: center;
      cursor: pointer;
      border: 2px dashed rgba(94, 96, 206, 0.3);
      transition: var(--transition);
      margin-bottom: 1.2rem;
      font-weight: 600;
      color: var(--primary);
    }
    
    .memory-label-upload:hover {
      background: rgba(94, 96, 206, 0.2);
    }
    
    .mood-history-container {
      max-height: 300px;
      overflow-y: auto;
      margin-top: 1.5rem;
    }
    
    .mood-entry {
      display: flex;
      justify-content: space-between;
      padding: 1rem;
      border-bottom: 1px solid var(--gray-light);
      align-items: center;
    }
    
    .mood-emoji-history {
      font-size: 1.8rem;
      margin-right: 1rem;
    }
    
    .chart-container {
      height: 250px;
      margin-top: 1.5rem;
    }
    
    /* Memory preview */
    .memory-preview {
      width: 100%;
      height: 220px;
      border-radius: var(--radius-md);
      background-color: var(--light);
      margin-bottom: 1.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      background: var(--light-alt);
      border: 1px dashed var(--primary-light);
    }
    
    .memory-preview img {
      max-width: 100%;
      max-height: 100%;
      object-fit: cover;
    }
    
    .memory-preview i {
      font-size: 3.5rem;
      color: var(--gray);
    }
    
    /* View memory modal */
    .memory-actions {
      display: flex;
      gap: 0.8rem;
      margin-top: 1.5rem;
    }
    
    /* Memory Book Modal */
    .memory-book {
      max-height: 60vh;
      overflow-y: auto;
    }
    
    .memory-book-entry {
      display: flex;
      align-items: center;
      padding: 1.2rem;
      border-bottom: 1px solid var(--gray-light);
      gap: 1.2rem;
      cursor: pointer;
      transition: var(--transition);
    }
    
    .memory-book-entry:hover {
      background: rgba(94, 96, 206, 0.05);
    }
    
    .memory-book-thumbnail {
      width: 70px;
      height: 70px;
      border-radius: var(--radius-sm);
      background-size: cover;
      background-position: center;
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--light-alt);
    }
    
    .memory-book-thumbnail i {
      font-size: 1.8rem;
      color: var(--gray);
    }
    
    .memory-book-details {
      flex: 1;
    }
    
    .memory-book-title {
      font-weight: 700;
      color: var(--dark);
      font-size: 1.1rem;
    }
    
    .memory-book-date {
      font-size: 0.85rem;
      color: var(--gray);
      margin-top: 0.3rem;
    }
    
    .memory-book-progress {
      margin-top: 1.5rem;
      padding: 1.2rem;
      background: rgba(94, 96, 206, 0.05);
      border-radius: var(--radius-md);
    }
    
    .memory-book-progress h4 {
      margin-bottom: 0.8rem;
      color: var(--primary);
      font-size: 1.1rem;
    }
    
    @keyframes scaleIn {
      from { transform: scale(0.9); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }
    
    /* Chat Interface */
    .chat-container {
      position: relative;
      width: 100%;
      height: 400px;
      background: white;
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-light);
      display: flex;
      flex-direction: column;
      overflow: hidden;
      border: 1px solid rgba(94, 96, 206, 0.1);
      margin-top: 1.5rem;
    }
    
    .chat-header {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
      padding: 1.2rem;
      display: flex;
      align-items: center;
      gap: 1rem;
      position: relative;
    }
    
    .chat-header .avatar {
      width: 45px;
      height: 45px;
      border-radius: 50%;
      background: white;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--primary);
      font-weight: 600;
      font-size: 1.3rem;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
    }
    
    .chat-header h3 {
      flex: 1;
      font-size: 1.2rem;
      font-weight: 500;
      font-family: 'Nunito', sans-serif;
    }
    
    .chat-settings {
      background: none;
      border: none;
      color: white;
      font-size: 1.2rem;
      cursor: pointer;
      padding: 0.6rem;
      border-radius: 50%;
      transition: var(--transition);
      margin-left: auto;
      margin-right: 0.5rem;
    }
    
    .chat-settings:hover {
      background: rgba(255, 255, 255, 0.2);
    }
    
    .close-chat {
      background: none;
      border: none;
      color: white;
      font-size: 1.3rem;
      cursor: pointer;
      padding: 0.6rem;
      border-radius: 50%;
      transition: var(--transition);
      display: none; /* Hide close button */
    }
    
    .chat-messages {
      flex: 1;
      padding: 1.2rem;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 1rem;
      -webkit-overflow-scrolling: touch;
      background: var(--light);
    }
    
    .message {
      max-width: 85%;
      padding: 1rem 1.2rem;
      border-radius: var(--radius-md);
      font-size: 1rem;
      position: relative;
      word-break: break-word;
      line-height: 1.5;
      animation: fadeIn 0.3s ease;
      box-shadow: var(--shadow-light);
      opacity: 0;
      transform: translateY(10px);
      animation: messageAppear 0.3s ease forwards;
    }
    
    @keyframes messageAppear {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .message.user {
      background: white;
      align-self: flex-end;
      border-top-right-radius: 0;
      border: 1px solid rgba(94, 96, 206, 0.1);
    }
    
    .message.companion {
      background: white;
      align-self: flex-start;
      border-top-left-radius: 0;
      border: 1px solid rgba(0, 206, 201, 0.1);
    }
    
    .message-time {
      font-size: 0.75rem;
      color: var(--gray);
      margin-top: 0.5rem;
      text-align: right;
    }
    
    .chat-input {
      display: flex;
      padding: 1rem;
      border-top: 1px solid rgba(94, 96, 206, 0.1);
      background: white;
    }
    
    .chat-input input {
      flex: 1;
      padding: 1rem;
      border: 1px solid rgba(94, 96, 206, 0.2);
      border-radius: var(--radius-md);
      font-size: 1rem;
      font-family: 'Nunito', sans-serif;
      transition: var(--transition);
    }
    
    .chat-input input:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(94, 96, 206, 0.2);
      outline: none;
    }
    
    .send-btn {
      background: var(--primary);
      color: white;
      border: none;
      width: 45px;
      height: 45px;
      border-radius: 50%;
      margin-left: 1rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: var(--transition);
      font-size: 1.2rem;
    }
    
    .send-btn:hover {
      background: var(--primary-dark);
      transform: scale(1.05);
    }

    /* Spinner for loading states */
    .spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(94, 96, 206, 0.3);
      border-radius: 50%;
      border-top-color: var(--primary);
      animation: spin 1s ease-in-out infinite;
      margin-right: 8px;
      vertical-align: middle;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .spinner-text {
      display: inline-block;
      vertical-align: middle;
    }
    
    /* Chat button */
    .chat-fab {
      display: none; /* Hide floating chat button */
    }
    
    /* Page sections for navigation */
    .page-section {
      display: none;
      animation: fadeIn 0.5s ease;
    }
    
    .page-section.active {
      display: block;
    }
    
    /* Mood chart */
    .mood-chart {
      width: 100%;
      height: 200px;
      margin-top: 1.5rem;
    }
    
    /* Companion selection */
    .companion-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 1.2rem;
      margin-top: 1.5rem;
    }
    
    @media (min-width: 480px) {
      .companion-grid {
        grid-template-columns: 1fr 1fr;
      }
    }
    
    .companion-select {
      border: 2px solid var(--gray-light);
      border-radius: var(--radius-md);
      padding: 1.5rem;
      text-align: center;
      cursor: pointer;
      transition: var(--transition);
      background: white;
    }
    
    .companion-select:hover {
      border-color: var(--primary-light);
      transform: translateY(-5px);
      box-shadow: var(--shadow-light);
    }
    
    .companion-select.selected {
      border-color: var(--primary);
      background: rgba(94, 96, 206, 0.05);
      box-shadow: var(--shadow-medium);
    }
    
    .companion-select .avatar {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      margin: 0 auto 1rem;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
      color: white;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
    }
    
    .companion-select h4 {
      margin-bottom: 0.5rem;
      color: var(--dark);
    }
    
    /* Responsive adjustments */
    @media (max-width: 480px) {
      .card {
        padding: 1.2rem;
      }
      
      .breath-container {
        width: 180px;
        height: 180px;
      }
      
      .chat-container {
        height: 350px;
      }
    }
    
    @media (min-width: 768px) {
      .container {
        max-width: 800px;
        padding: 0 1.5rem;
      }
      
      .action-cards {
        grid-template-columns: 1fr 1fr;
      }
      
      .chat-container {
        height: 380px;
      }
    }
    
    /* UI Enhancements */
    .section-title {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 1.5rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid var(--gray-light);
    }
    
    .section-title i {
      font-size: 1.2rem;
      color: var(--primary);
      background: var(--primary-light);
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .app-header {
      text-align: center;
      margin-bottom: 1.5rem;
      padding: 0 1rem;
    }
    
    .app-header h1 {
      font-size: 1.8rem;
      color: var(--primary);
      margin-bottom: 0.5rem;
    }
    
    .app-header p {
      color: var(--gray);
      font-size: 1rem;
      max-width: 600px;
      margin: 0 auto;
    }
    
    .card-content {
      padding: 1rem 0;
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1rem;
      margin-top: 1.5rem;
    }
    
    .stat-card {
      background: rgba(255, 255, 255, 0.95);
      border-radius: var(--radius-md);
      padding: 1.2rem;
      text-align: center;
      box-shadow: var(--shadow-light);
      border: 1px solid rgba(94, 96, 206, 0.1);
    }
    
    .stat-card i {
      font-size: 1.8rem;
      color: var(--primary);
      margin-bottom: 0.8rem;
    }
    
    .stat-card h4 {
      font-size: 1.2rem;
      margin-bottom: 0.3rem;
    }
    
    .stat-card p {
      color: var(--gray);
      font-size: 0.9rem;
    }
    
    .divider {
      height: 1px;
      background: var(--gray-light);
      margin: 1.5rem 0;
    }
    
    .empty-state {
      text-align: center;
      padding: 2rem 1rem;
      color: var(--gray);
    }
    
    .empty-state i {
      font-size: 3rem;
      margin-bottom: 1rem;
      color: var(--gray-light);
    }
    
    .empty-state h4 {
      color: var(--dark);
      margin-bottom: 0.5rem;
    }
    
    /* Improved companion section */
    .companion-card {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      padding: 1.5rem;
      background: white;
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-light);
      border: 1px solid rgba(94, 96, 206, 0.1);
      transition: var(--transition);
    }
    
    .companion-card:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow-medium);
    }
    
    /* New UI Enhancements */
    .dashboard-header {
      padding: 1rem;
      text-align: center;
      margin-bottom: 0.5rem;
    }
    
    .greeting {
      font-size: 1.1rem;
      color: var(--primary);
      font-weight: 600;
      margin-bottom: 0.5rem;
    }
    
    .date-display {
      font-size: 0.9rem;
      color: var(--gray);
    }
    
    .progress-container {
      background: rgba(255, 255, 255, 0.9);
      border-radius: var(--radius-md);
      padding: 1rem;
      margin: 1rem 0;
      box-shadow: var(--shadow-light);
      border: 1px solid rgba(94, 96, 206, 0.1);
    }
    
    .progress-title {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }
    
    .progress-title h4 {
      font-size: 1rem;
      color: var(--dark);
    }
    
    .progress-title span {
      font-size: 0.9rem;
      color: var(--primary);
      font-weight: 700;
    }
    
    .insight-card {
      background: linear-gradient(135deg, rgba(100, 223, 223, 0.08), rgba(94, 96, 206, 0.08));
      border: 1px solid rgba(100, 223, 223, 0.18);
      padding: 1.5rem;
      border-radius: var(--radius-md);
      margin: 1rem 0;
    }
    
    .insight-card h3 {
      display: flex;
      align-items: center;
      gap: 0.8rem;
      margin-bottom: 1rem;
      font-size: 1.2rem;
      color: var(--primary);
    }
    
    .insight-card p {
      font-size: 1rem;
      line-height: 1.6;
      color: var(--dark);
    }
    
    /* Breathing animation enhancements */
    .breath-circle {
      transition: all 1.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }
    
    .breath-text {
      font-size: 1.3rem;
      font-weight: 600;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
      transition: all 0.5s ease;
    }
    
    /* Mood colors */
    .mood-option[data-mood="awful"] { background: rgba(229, 62, 62, 0.08); }
    .mood-option[data-mood="sad"] { background: rgba(246, 173, 85, 0.08); }
    .mood-option[data-mood="neutral"] { background: rgba(138, 155, 168, 0.08); }
    .mood-option[data-mood="great"] { background: rgba(72, 187, 120, 0.08); }
    
    .mood-option.selected[data-mood="awful"] { background: rgba(229, 62, 62, 0.15); }
    .mood-option.selected[data-mood="sad"] { background: rgba(246, 173, 85, 0.15); }
    .mood-option.selected[data-mood="neutral"] { background: rgba(138, 155, 168, 0.15); }
    .mood-option.selected[data-mood="great"] { background: rgba(72, 187, 120, 0.15); }
    
    /* Profile enhancements */
    .profile-header {
      text-align: center;
      padding: 1.5rem 0;
    }
    
    /* Tool cards */
    .tool-card {
      background: rgba(255, 255, 255, 0.95);
      border-radius: var(--radius-md);
      padding: 1.5rem;
      margin-bottom: 1rem;
      box-shadow: var(--shadow-light);
      border: 1px solid rgba(94, 96, 206, 0.1);
      transition: var(--transition);
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    
    .tool-card:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow-medium);
    }
    
    .tool-icon {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: var(--primary-light);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      color: var(--primary);
    }
    
    .tool-info {
      flex: 1;
    }
    
    .tool-info h3 {
      font-size: 1.1rem;
      margin-bottom: 0.3rem;
      color: var(--dark);
    }
    
    .tool-info p {
      font-size: 0.9rem;
      color: var(--gray);
    }
  /* Added loading spinner */
    .loading-spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(94, 96, 206, 0.3);
      border-radius: 50%;
      border-top-color: var(--primary);
      animation: spin 1s ease-in-out infinite;
      margin-right: 8px;
      vertical-align: middle;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .loading-text {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      color: var(--gray);
    }
    
    /* Companion change animation */
    @keyframes companionChange {
      0% { opacity: 0; transform: scale(0.9); }
      100% { opacity: 1; transform: scale(1); }
    }
    
    .companion-change {
      animation: companionChange 0.5s ease;
    }
    
    /* Enhanced progress visualization */
    .progress-details {
      display: flex;
      justify-content: space-between;
      margin-top: 10px;
    }
    
    .progress-source {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      flex: 1;
    }
    
    .progress-source-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--primary-light);
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 0.5rem;
      color: white;
      font-size: 1.2rem;
      box-shadow: var(--shadow-light);
    }
    
    .progress-source-value {
      font-weight: 800;
      font-size: 1rem;
      color: var(--primary);
    }
    
    .progress-source-label {
      font-size: 0.8rem;
      color: var(--gray);
      text-align: center;
    }
    
    /* Improved companion card */
    .companion-card {
      background: rgba(255, 255, 255, 0.97);
      border-radius: var(--radius-md);
      padding: 1.5rem;
      margin: 1rem 0;
      position: relative;
      transition: var(--transition);
      box-shadow: var(--shadow-light);
      border: 1px solid rgba(94, 96, 206, 0.1);
    }
    
    .companion-header {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1.2rem;
    }
    
    .companion-avatar {
      width: 70px;
      height: 70px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 2rem;
      box-shadow: 0 6px 18px rgba(94, 96, 206, 0.35);
      flex-shrink: 0;
    }
    
    .companion-info {
      flex: 1;
    }
    
    .companion-name {
      font-weight: 800;
      font-size: 1.3rem;
      color: var(--dark);
    }
    
    .companion-role {
      font-size: 0.9rem;
      color: var(--gray);
      margin-top: 0.3rem;
    }
    
    .specialties-container {
      display: flex;
      flex-wrap: wrap;
      gap: 0.6rem;
      margin-top: 1rem;
    }
    
    .specialty-tag {
      background: rgba(94, 96, 206, 0.12);
      color: var(--primary);
      padding: 0.5rem 1rem;
      border-radius: 30px;
      font-size: 0.85rem;
      font-weight: 700;
      border: 1px solid rgba(94, 96, 206, 0.25);
    }
    
    /* Chat improvements */
    .message.companion {
      border-left: 3px solid var(--secondary);
    }
    
    .message.user {
      border-right: 3px solid var(--primary);
    }
  /* Add new styles for subscription elements */
    .credit-counter {
      display: flex;
      align-items: center;
      gap: 0.3rem;
      background: rgba(94, 96, 206, 0.1);
      padding: 0.5rem 0.8rem;
      border-radius: 20px;
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--primary);
    }
    
    .credit-counter i {
      color: var(--primary);
    }
    
    .credit-counter.low {
      background: rgba(255, 107, 107, 0.1);
      color: var(--accent);
    }
    
    .credit-counter.low i {
      color: var(--accent);
    }
    
    .premium-badge {
      background: linear-gradient(135deg, #FFD700, #FFA500);
      color: #8B4513;
      padding: 0.3rem 0.8rem;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }
    
    .subscription-section {
      margin-top: 1.5rem;
      padding: 1.5rem;
      border-radius: var(--radius-md);
      background: rgba(255, 255, 255, 0.9);
      border: 1px solid rgba(94, 96, 206, 0.15);
      box-shadow: var(--shadow-light);
    }
    
    .subscription-plans {
      display: grid;
      grid-template-columns: 1fr;
      gap: 1rem;
      margin-top: 1.5rem;
    }
    
    @media (min-width: 768px) {
      .subscription-plans {
        grid-template-columns: 1fr 1fr;
      }
    }
    
    .subscription-plan {
      border: 2px solid var(--gray-light);
      border-radius: var(--radius-md);
      padding: 1.5rem;
      transition: var(--transition);
      position: relative;
      overflow: hidden;
    }
    
    .subscription-plan.featured {
      border: 2px solid var(--primary);
      transform: scale(1.02);
      box-shadow: var(--shadow-medium);
    }
    
    .subscription-plan.featured::before {
      content: 'BEST VALUE';
      position: absolute;
      top: 10px;
      right: -25px;
      background: var(--primary);
      color: white;
      padding: 0.3rem 2rem;
      font-size: 0.8rem;
      font-weight: 700;
      transform: rotate(45deg);
    }
    
    .subscription-plan h4 {
      font-size: 1.3rem;
      margin-bottom: 0.5rem;
      color: var(--dark);
    }
    
    .subscription-price {
      font-size: 2rem;
      font-weight: 800;
      margin-bottom: 1rem;
      color: var(--primary);
    }
    
    .subscription-price .period {
      font-size: 1rem;
      font-weight: 600;
      color: var(--gray);
    }
    
    .subscription-features {
      list-style: none;
      margin: 1.5rem 0;
    }
    
    .subscription-features li {
      padding: 0.5rem 0;
      display: flex;
      align-items: flex-start;
      gap: 0.7rem;
    }
    
    .subscription-features li i {
      color: var(--success);
      font-size: 1.1rem;
      margin-top: 0.2rem;
    }
    
    .plan-savings {
      background: var(--primary-light);
      padding: 0.5rem;
      border-radius: var(--radius-sm);
      text-align: center;
      font-weight: 600;
      margin-top: 1rem;
      color: var(--primary);
    }
    
    .current-plan {
      background: var(--success-light);
      color: var(--success);
      padding: 0.5rem;
      border-radius: var(--radius-sm);
      text-align: center;
      font-weight: 600;
      margin-top: 1rem;
    }
    
    .credit-alert {
      background: var(--accent-light);
      color: var(--accent);
      padding: 1rem;
      border-radius: var(--radius-md);
      margin-top: 1rem;
      text-align: center;
      font-weight: 600;
    }
    
    .credit-alert i {
      margin-right: 0.5rem;
    }
    
    .upgrade-prompt {
      background: linear-gradient(135deg, rgba(94, 96, 206, 0.08), rgba(100, 223, 223, 0.08));
      border: 1px solid rgba(94, 96, 206, 0.18);
      padding: 1.5rem;
      border-radius: var(--radius-md);
      margin: 1rem 0;
      text-align: center;
    }
    
    .upgrade-prompt h4 {
      font-size: 1.2rem;
      color: var(--primary);
      margin-bottom: 1rem;
    }
    
    .credit-usage {
      display: flex;
      justify-content: space-between;
      margin-top: 1rem;
      background: var(--light-alt);
      padding: 1rem;
      border-radius: var(--radius-md);
    }
    
    .credit-usage-item {
      text-align: center;
      flex: 1;
    }
    
    .credit-usage-value {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--primary);
    }
    
    .credit-usage-label {
      font-size: 0.9rem;
      color: var(--gray);
    }
    
    /* File upload */
    .file-upload-container {
      border: 2px dashed var(--gray-light);
      border-radius: var(--radius-md);
      padding: 2rem;
      text-align: center;
      margin: 1.5rem 0;
      cursor: pointer;
      transition: var(--transition);
    }
    
    .file-upload-container:hover {
      border-color: var(--primary);
      background: rgba(94, 96, 206, 0.05);
    }
    
    .file-upload-container i {
      font-size: 3rem;
      color: var(--gray);
      margin-bottom: 1rem;
    }
  </style>
</head>
<body>
  <!-- Mobile Header -->
  <div class="mobile-header">
    <div class="app-logo">
      <i class="fas fa-brain"></i>
      <span>Therapathy</span>
    </div>
    <div class="credit-counter" id="credit-counter" title="Remaining credits">
      <i class="fas fa-coins"></i>
      <span id="credit-count">50</span>
    </div>
    <div class="user-avatar" id="userInitialMobile" title="Profile">
      <span id="userInitialTextMobile">U</span>
    </div>
  </div>

  <!-- Dashboard Container -->
  <div class="container dashboard-container" id="dashboard-container" style="display: none;">
    <!-- Dashboard Header -->
    <div class="dashboard-header">
      <div class="greeting" id="greeting">Good afternoon</div>
      <div class="date-display" id="currentDate"></div>
    </div>
    
    <!-- Page Sections -->
    <div id="home-section" class="page-section active">
      <!-- Affirmation Card -->
      <div class="card affirmation-card" id="affirmationCard">
        <h3><i class="fas fa-quote-left"></i> Daily Affirmation</h3>
        <p id="affirmation">"Healing isn't about forgetting, it's about learning to carry your loss with grace."</p>
        <div class="card-actions">
          <button class="btn btn-secondary" id="refreshAffirmation">
            <i class="fas fa-sync-alt"></i> New
          </button>
          <button class="btn btn-accent" id="saveAffirmation">
            <i class="far fa-heart"></i> Save
          </button>
        </div>
      </div>

      <!-- Companion Card -->
      <div class="companion-card">
        <div class="companion-header">
          <div class="companion-avatar" id="companion-avatar">
            <i class="fas fa-smile"></i>
          </div>
          <div class="companion-info">
            <div class="companion-name" id="companion-name">Elena</div>
            <div class="companion-role" id="companion-role">Healing Guide</div>
          </div>
          <button class="btn btn-secondary btn-sm" id="change-companion-btn">
            <i class="fas fa-exchange-alt"></i> Change
          </button>
        </div>
        <div class="specialties-container" id="companion-specialties">
          <div class="specialty-tag">Grief</div>
          <div class="specialty-tag">Compassion</div>
          <div class="specialty-tag">Support</div>
        </div>
      </div>

      <!-- Chat Interface -->
      <div class="chat-container" id="chat-container">
        <div class="chat-header">
          <div class="avatar">
            <i class="fas fa-smile" id="chat-header-avatar"></i>
          </div>
          <h3 id="chat-title">Chat with Elena</h3>
          <button class="chat-settings" id="chat-settings" aria-label="Change companion">
            <i class="fas fa-user-friends"></i>
          </button>
        </div>
        <div class="chat-messages" id="chat-messages">
          <div class="loading-text" id="chat-loading">
            <div class="loading-spinner"></div> Connecting with your companion...
          </div>
        </div>
        <div class="chat-input">
          <input type="text" id="chat-input" placeholder="Type your message...">
          <button class="send-btn" id="send-btn" aria-label="Send message">
            <i class="fas fa-paper-plane"></i>
          </button>
        </div>
      </div>
      
      <!-- Credit Alert for Free Users -->
      <div class="credit-alert" id="credit-alert" style="display: none;">
        <i class="fas fa-exclamation-circle"></i>
        You have <span id="remaining-credits">0</span> credits remaining. Upgrade for unlimited access.
      </div>
      
      <!-- Upgrade Prompt -->
      <div class="upgrade-prompt" id="upgrade-prompt" style="display: none;">
        <h4>Upgrade to Premium</h4>
        <p>Get unlimited chats and full access to all features</p>
        <button class="btn btn-primary" id="upgrade-btn">
          <i class="fas fa-crown"></i> Upgrade Now
        </button>
      </div>

      <!-- Breathing Exercise -->
      <div class="card">
        <h3><i class="fas fa-wind"></i> Calming Breath</h3>
        <div class="breath-container">
          <div class="breath-visual"></div>
          <div class="breath-phase"></div>
          <div class="breath-circle pulse">
            <span id="breath-text" class="breath-text">Breathe In</span>
          </div>
        </div>
        
        <div class="breath-stats">
          <div class="breath-stat">
            <div class="stat-value" id="cycle-count">0</div>
            <div class="stat-label">Cycles</div>
          </div>
          <div class="breath-stat">
            <div class="stat-value" id="timer">0:00</div>
            <div class="stat-label">Time</div>
          </div>
        </div>
        
        <div class="breath-instruction" id="instruction">
          Breathe in slowly through your nose...
        </div>
        
        <div class="breath-controls">
          <button class="btn btn-primary" id="start-breath">
            <i class="fas fa-play"></i> Start
          </button>
          <button class="btn btn-secondary" id="reset-breath">
            <i class="fas fa-redo"></i> Reset
          </button>
        </div>
      </div>
      
      <!-- Mood Tracker -->
      <div class="card">
        <h3><i class="fas fa-smile"></i> How You Feel</h3>
        
        <div class="mood-options">
          <div class="mood-option" data-mood="awful">
            <div class="mood-emoji"></div>
            <div class="mood-label">Awful</div>
          </div>
          <div class="mood-option" data-mood="sad">
            <div class="mood-emoji"></div>
            <div class="mood-label">Sad</div>
          </div>
          <div class="mood-option" data-mood="neutral">
            <div class="mood-emoji"></div>
            <div class="mood-label">Neutral</div>
          </div>
          <div class="mood-option selected" data-mood="great">
            <div class="mood-emoji"></div>
            <div class="mood-label">Great</div>
          </div>
        </div>
        
        <div class="quick-actions">
          <button class="btn btn-secondary btn-sm" id="mood-history">
            <i class="fas fa-history"></i> History
          </button>
          <button class="btn btn-secondary btn-sm" id="mood-insights">
            <i class="fas fa-chart-pie"></i> Insights
          </button>
        </div>
      </div>
    </div>
    
    <!-- Tools Page -->
    <div id="tools-section" class="page-section">
      <div class="card">
        <h3><i class="fas fa-tools"></i> Healing Tools</h3>
        <p>Explore our collection of therapeutic tools</p>
        
        <div class="action-cards">
          <!-- Journal Button -->
          <div class="action-card" id="journal-btn">
            <i class="fas fa-book-open"></i>
            <h3>Journal</h3>
            <p>Express your thoughts with guided prompts</p>
            <a href="journal.html" class="btn btn-primary" id="open-journal">
              Begin <i class="fas fa-chevron-right"></i>
            </a>
          </div>
          
          <!-- Self-Care Button -->
          <div class="action-card" id="compassion-btn">
            <i class="fas fa-hand-holding-heart"></i>
            <h3>Self-Care</h3>
            <p>Exercises to cultivate self-kindness</p>
            <a href="#" class="btn btn-primary">
              Explore <i class="fas fa-chevron-right"></i>
            </a>
          </div>
          
          <!-- Meditation Button -->
          <div class="action-card">
            <i class="fas fa-headphones"></i>
            <h3>Meditation Library</h3>
            <p>Calming meditations for grief and healing</p>
            <a href="#" class="btn btn-primary">
              Explore <i class="fas fa-chevron-right"></i>
            </a>
          </div>
          
          <!-- Cognitive Exercises Button -->
          <div class="action-card">
            <i class="fas fa-brain"></i>
            <h3>Cognitive Exercises</h3>
            <p>Tools to reframe negative thoughts</p>
            <a href="#" class="btn btn-primary">
              Begin <i class="fas fa-chevron-right"></i>
            </a>
          </div>
        </div>
      </div>
      
      <!-- Healing Insights -->
      <div class="insight-card">
        <h3><i class="fas fa-lightbulb"></i> Today's Insight</h3>
        <p>"Grief is not a disorder, a disease or a sign of weakness. It is an emotional, physical and spiritual necessity, the price you pay for love."</p>
      </div>
    </div>
    
    <!-- Memories Page -->
    <div id="memories-section" class="page-section">
      <div class="card">
        <h3><i class="fas fa-memory"></i> Cherished Memories</h3>
        <p>Preserve and revisit special moments</p>
        
        <div class="memory-container" id="memory-container">
          <div class="loading-text" id="memories-loading">
            <div class="loading-spinner"></div> Loading your memories...
          </div>
        </div>
        
        <div class="file-upload-container" id="memory-upload">
          <i class="fas fa-cloud-upload-alt"></i>
          <h4>Upload a Memory</h4>
          <p>Click or drag files to upload</p>
          <p class="credit-info">(Cost: 10 credits per file)</p>
          <input type="file" id="memory-file" style="display: none;">
        </div>
        
        <div class="memory-actions">
          <button class="btn btn-primary" id="memory-book-btn">
            <i class="fas fa-book"></i> Memory Book
          </button>
        </div>
      </div>
    </div>
    
    <!-- Profile Page -->
    <div id="profile-section" class="page-section">
      <div class="profile-header">
        <div class="user-avatar" style="width: 100px; height: 100px; font-size: 2.2rem; margin: 0 auto;">
          <span id="profile-initial">U</span>
        </div>
        <div class="companion-name" id="profile-name">User Name</div>
        <div class="companion-role">Member since <span id="join-date">Jan 2023</span></div>
      </div>
      
      <div class="card">
        <div class="progress-title">
          <h4>Healing Progress</h4>
          <span id="profile-progress-percent">0%</span>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" id="profile-progress-fill" style="width: 0%"></div>
        </div>
        
        <div class="progress-details">
          <div class="progress-source">
            <div class="progress-source-icon">
              <i class="fas fa-smile"></i>
            </div>
            <div class="progress-source-value" id="profile-mood-source">0</div>
            <div class="progress-source-label">Moods</div>
          </div>
          <div class="progress-source">
            <div class="progress-source-icon">
              <i class="fas fa-comment"></i>
            </div>
            <div class="progress-source-value" id="profile-chat-source">0</div>
            <div class="progress-source-label">Messages</div>
          </div>
          <div class="progress-source">
            <div class="progress-source-icon">
              <i class="fas fa-book"></i>
            </div>
            <div class="progress-source-value" id="profile-journal-source">0</div>
            <div class="progress-source-label">Journals</div>
          </div>
          <div class="progress-source">
            <div class="progress-source-icon">
              <i class="fas fa-heart"></i>
            </div>
            <div class="progress-source-value" id="profile-memory-source">0</div>
            <div class="progress-source-label">Memories</div>
          </div>
        </div>
        
        <!-- Credit Usage -->
        <div class="credit-usage" id="credit-usage-section">
          <div class="credit-usage-item">
            <div class="credit-usage-value" id="credits-used">0</div>
            <div class="credit-usage-label">Credits Used</div>
          </div>
          <div class="credit-usage-item">
            <div class="credit-usage-value" id="credits-remaining">50</div>
            <div class="credit-usage-label">Credits Remaining</div>
          </div>
        </div>
        
        <button class="btn btn-primary" style="margin-top: 1.5rem;" id="account-settings-btn">
          <i class="fas fa-cog"></i> Account Settings
        </button>
        
        <button class="btn btn-secondary" style="margin-top: 1rem;" id="change-companion-btn-profile">
          <i class="fas fa-user-friends"></i> Change Companion
        </button>
      </div>
      
      <!-- Subscription Section -->
      <div class="subscription-section">
        <h3><i class="fas fa-crown"></i> Subscription Plan</h3>
        <div class="current-plan" id="current-plan">Free Tier (50 Credits)</div>
        
        <div class="subscription-plans">
          <div class="subscription-plan">
            <h4>Free Tier</h4>
            <div class="subscription-price">$0<span class="period">/month</span></div>
            <ul class="subscription-features">
              <li><i class="fas fa-check"></i> 50 sign-up credits</li>
              <li><i class="fas fa-check"></i> 10 monthly credits</li>
              <li><i class="fas fa-check"></i> Basic tools</li>
              <li><i class="fas fa-check"></i> Limited AI chats</li>
              <li><i class="fas fa-check"></i> Mood tracking</li>
            </ul>
          </div>
          
          <div class="subscription-plan featured">
            <h4>Premium Yearly</h4>
            <div class="subscription-price">$110<span class="period">/year</span></div>
            <div class="plan-savings">Save $70 vs monthly</div>
            <ul class="subscription-features">
              <li><i class="fas fa-check"></i> Unlimited AI chats</li>
              <li><i class="fas fa-check"></i> Full tool access</li>
              <li><i class="fas fa-check"></i> Premium features</li>
              <li><i class="fas fa-check"></i> +50 bonus credits</li>
              <li><i class="fas fa-check"></i> Priority support</li>
            </ul>
          </div>
          
          <div class="subscription-plan">
            <h4>Premium Monthly</h4>
            <div class="subscription-price">$15<span class="period">/month</span></div>
            <ul class="subscription-features">
              <li><i class="fas fa-check"></i> Unlimited AI chats</li>
              <li><i class="fas fa-check"></i> Full tool access</li>
              <li><i class="fas fa-check"></i> Premium features</li>
              <li><i class="fas fa-check"></i> Ad-free experience</li>
              <li><i class="fas fa-check"></i> Early access</li>
            </ul>
          </div>
        </div>
        
        <button class="btn btn-primary" style="margin-top: 1rem; width: 100%;" id="subscribe-btn">
          <i class="fas fa-crown"></i> Upgrade to Premium
        </button>
      </div>
      
      <!-- Sign Out Button -->
      <div style="text-align: center; margin: 1.5rem 0;">
        <button class="btn-signout" id="signout-btn" aria-label="Sign out">
          <i class="fas fa-sign-out-alt"></i> Sign Out
        </button>
      </div>
    </div>
  </div>

  <!-- Login Prompt -->
  <div class="container login-prompt" id="login-prompt">
    <h2>Welcome to Therapathy</h2>
    <p>Your AI-powered healing companion for grief counseling and emotional support</p>
    <button class="btn-login" id="go-to-login">
      <i class="fas fa-sign-in-alt"></i> Go to Login Page
    </button>
  </div>



  <!-- Account Settings Modal -->
  <div class="modal" id="account-settings-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Account Settings</h3>
        <button class="close-modal" id="close-settings-modal">&times;</button>
      </div>
      <div class="form-group">
        <label for="settings-name">Full Name</label>
        <input type="text" id="settings-name" class="form-control" placeholder="Your full name">
      </div>
      <div class="form-group">
        <label for="settings-email">Email Address</label>
        <input type="email" id="settings-email" class="form-control" placeholder="Your email">
      </div>
      <div class="form-group">
        <label for="settings-password">New Password</label>
        <input type="password" id="settings-password" class="form-control" placeholder="Leave blank to keep current">
      </div>
      <div class="form-group">
        <label for="settings-confirm">Confirm Password</label>
        <input type="password" id="settings-confirm" class="form-control" placeholder="Confirm new password">
      </div>
      <button class="btn btn-primary" id="save-settings">
        <i class="fas fa-save"></i> Save Changes
      </button>
    </div>
  </div>

  <!-- Memory Book Modal -->
  <div class="modal" id="memory-book-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Memory Book</h3>
        <button class="close-modal" id="close-memory-book-modal">&times;</button>
      </div>
      <div class="memory-book" id="memory-book-content">
        <div class="loading-text">
          <div class="loading-spinner"></div> Loading your memories...
        </div>
      </div>
    </div>
  </div>

  <!-- Bottom Navigation -->
  <nav class="bottom-nav">
    <a href="#" class="nav-item active" data-target="home-section">
      <i class="fas fa-home"></i>
      <span class="nav-label">Home</span>
    </a>
    <a href="#" class="nav-item" data-target="tools-section">
      <i class="fas fa-tools"></i>
      <span class="nav-label">Tools</span>
    </a>
    <a href="#" class="nav-item" data-target="memories-section">
      <i class="fas fa-memory"></i>
      <span class="nav-label">Memories</span>
    </a>
    <a href="#" class="nav-item" data-target="profile-section">
      <i class="fas fa-user"></i>
      <span class="nav-label">Profile</span>
    </a>
  </nav>

  <!-- Toast Notification -->
  <div class="toast" id="toast"></div>
  
  <!-- Companion Selection Modal -->
  <div class="modal" id="companion-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Choose Your Companion</h3>
        <button class="close-modal" id="close-companion-modal">&times;</button>
      </div>
      <div class="companion-grid">
        <div class="companion-select" data-companion="elena">
          <div class="avatar"><i class="fas fa-smile"></i></div>
          <h4>Elena</h4>
          <p>Healing Guide</p>
        </div>
        <div class="companion-select" data-companion="david">
          <div class="avatar"><i class="fas fa-leaf"></i></div>
          <h4>David</h4>
          <p>Mindfulness Coach</p>
        </div>
        <div class="companion-select" data-companion="sophia">
          <div class="avatar"><i class="fas fa-lightbulb"></i></div>
          <h4>Sophia</h4>
          <p>Therapeutic Guide</p>
        </div>
      </div>
    </div>
  </div>
  
  <script>
    // Initialize Supabase with demo credentials
    const SUPABASE_URL = 'https://retpsdyfgdzwntxhnjgz.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJldHBzZHlmZ2R6d250eGhuamd6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM0OTQ5MzcsImV4cCI6MjA2OTA3MDkzN30.jbDmAbnBifiM8Kg54TZw8zArb2XzeXjNSwXMujNuDQ4';
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    // State variables
    let currentMood = "great";
    let breathInterval;
    let isBreathingActive = false;
    let cycleCount = 0;
    let secondsElapsed = 0;
    let currentPhase = 0;
    let progress = 0;
    let currentUser = null;
    let moodChart = null;
    let currentCompanion = "elena";
    let conversationHistory = [];
    let memories = [];
    let progressSources = {
      mood: 0,
      chat: 0,
      journal: 0,
      memories: 0
    };
    
    // Subscription state
    let subscriptionStatus = "free"; // "free" or "premium"
    let credits = 50;
    let creditsUsed = 0;
    
    // Define companions
    const companions = {
      "elena": {
        name: "Elena",
        role: "Healing Guide",
        specialties: ["Grief", "Compassion", "Support"],
        avatar: "fas fa-smile",
        intro: "Hi there! I'm Elena, your healing companion. How are you feeling today?",
        responses: [
          "I understand how you feel. Would you like to talk more about this?",
          "That sounds challenging. Remember to be gentle with yourself during this process.",
          "Thank you for sharing that with me. How has this been affecting your daily life?",
          "I appreciate you opening up about this. What's one thing that brought you comfort today?",
          "Your feelings are valid. Would it help to explore some coping strategies together?",
          "It takes courage to share what you're going through. I'm here to support you.",
          "Let's take a moment to breathe together. Would that help right now?",
          "I'm listening. Would you like to share more about what you're experiencing?"
        ]
      },
      "david": {
        name: "David",
        role: "Mindfulness Coach",
        specialties: ["Mindfulness", "Resilience", "Meditation"],
        avatar: "fas fa-leaf",
        intro: "Hello, I'm David. I'm here to help you find peace and mindfulness on your healing journey.",
        responses: [
          "Let's take a deep breath together. Inhale slowly... and exhale.",
          "Mindfulness can help us navigate difficult emotions. Would you like to try a grounding exercise?",
          "I hear you. Remember that emotions are temporary visitors. How can we find calm right now?",
          "Notice your breathing. Where do you feel this emotion in your body?",
          "Let's practice being present. Name three things you can see around you.",
          "Difficult moments are opportunities for growth. What is this experience teaching you?",
          "I'm here to guide you back to the present moment whenever you feel overwhelmed.",
          "Would a short guided meditation help you right now?"
        ]
      },
      "sophia": {
        name: "Sophia",
        role: "Therapeutic Guide",
        specialties: ["Cognitive Therapy", "Self-Discovery", "Empowerment"],
        avatar: "fas fa-lightbulb",
        intro: "Hi, I'm Sophia. Let's explore your thoughts and feelings together to foster healing and growth.",
        responses: [
          "That's an interesting perspective. What evidence supports this thought?",
          "How might you reframe that situation in a more balanced way?",
          "What strengths have helped you through difficult times in the past?",
          "Let's explore alternative perspectives. What might be another way to view this?",
          "I notice a pattern here. How might we challenge that thought together?",
          "What would you tell a friend who was experiencing what you're going through?",
          "Let's examine the evidence for and against that thought.",
          "What small step could you take today to move toward healing?"
        ]
      }
    };

    // Helper function to safely get DOM elements
    function getElement(id) {
      const el = document.getElementById(id);
      if (!el) console.warn(`Element with ID ${id} not found`);
      return el;
    }

    // Update credit display
    function updateCreditDisplay() {
      const creditCount = getElement('credit-count');
      const creditCounter = getElement('credit-counter');
      const creditsRemaining = getElement('credits-remaining');
      const creditsUsedEl = getElement('credits-used');
      const creditAlert = getElement('credit-alert');
      const upgradePrompt = getElement('upgrade-prompt');
      
      if (creditCount) creditCount.textContent = credits;
      if (creditsRemaining) creditsRemaining.textContent = credits;
      if (creditsUsedEl) creditsUsedEl.textContent = creditsUsed;
      
      // Update credit counter style
      if (creditCounter) {
        if (credits < 5) {
          creditCounter.classList.add('low');
        } else {
          creditCounter.classList.remove('low');
        }
      }
      
      // Show/hide alerts based on credits
      if (creditAlert) {
        if (subscriptionStatus === "free" && credits < 5) {
          creditAlert.style.display = 'block';
          if (getElement('remaining-credits')) {
            getElement('remaining-credits').textContent = credits;
          }
        } else {
          creditAlert.style.display = 'none';
        }
      }
      
      // Show upgrade prompt for free users
      if (upgradePrompt) {
        if (subscriptionStatus === "free" && credits < 10) {
          upgradePrompt.style.display = 'block';
        } else {
          upgradePrompt.style.display = 'none';
        }
      }
    }

    // Set greeting based on time of day
    function setGreeting() {
      const hour = new Date().getHours();
      let greeting;
      
      if (hour < 12) {
        greeting = "Good morning";
      } else if (hour < 18) {
        greeting = "Good afternoon";
      } else {
        greeting = "Good evening";
      }
      
      const greetingEl = document.getElementById('greeting');
      if (greetingEl) {
        greetingEl.textContent = greeting;
      }
    }

    // Set current date
    function setCurrentDate() {
      const dateEl = getElement('currentDate');
      if (dateEl) {
        const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
        dateEl.textContent = new Date().toLocaleDateString(undefined, options);
      }
    }

    // Initialize the dashboard
    document.addEventListener('DOMContentLoaded', async function() {
      // Set up UI elements
      setGreeting();
      setCurrentDate();
      initBreathingExercise();
      setupEventListeners();
      
      // Check user session
      await checkUserSession();
      
      // If user is logged in, initialize the rest
      if (currentUser) {
        loadCompanion();
        startCompanionChat();
        loadMemories();
        updateProgressBar();
        updateCreditDisplay();
      }
    });

    // Check user session and load data
    async function checkUserSession() {
      const { data: { user }, error } = await supabase.auth.getUser();
      
      if (user) {
        currentUser = user;
        await fetchUserProfile();
        getElement('login-prompt').style.display = 'none';
        getElement('dashboard-container').style.display = 'block';
        initializeDashboard();
      } else {
        getElement('login-prompt').style.display = 'block';
        getElement('dashboard-container').style.display = 'none';
      }
    }

    // Fetch user profile from database
    async function fetchUserProfile() {
      if (!currentUser) return;
      
      // In a real app, you would fetch from your profiles table
      // For demo purposes, we'll simulate profile data
      const profile = {
        id: currentUser.id,
        full_name: currentUser.user_metadata.full_name || "Demo User",
        companion: "elena",
        subscription_status: "free",
        credits: 50,
        join_date: new Date().toLocaleDateString('en-US', { month: 'short', year: 'numeric' })
      };
      
      // Update user data
      currentUser.profile = profile;
      
      // Set subscription status and credits
      subscriptionStatus = profile.subscription_status || 'free';
      credits = profile.credits || 50;
      currentCompanion = profile.companion || 'elena';
      
      // Update UI
      const userInitials = currentUser.profile.full_name.split(' ').map(n => n[0]).join('').toUpperCase() || 'U';
      ['userInitialTextMobile', 'profile-initial'].forEach(id => {
        const el = getElement(id);
        if (el) el.textContent = userInitials;
      });
      
      const profileName = getElement('profile-name');
      if (profileName) {
        profileName.textContent = currentUser.profile.full_name || 'User';
      }
      
      const joinDate = getElement('join-date');
      if (joinDate) {
        joinDate.textContent = profile.join_date || 'Jan 2023';
      }
    }

    // Initialize the dashboard with user data
    function initializeDashboard() {
      // Update UI with user data
      const userInitials = currentUser.profile.full_name.split(' ').map(n => n[0]).join('').toUpperCase() || 'U';
      ['userInitialTextMobile', 'profile-initial'].forEach(id => {
        const el = getElement(id);
        if (el) el.textContent = userInitials;
      });
      
      const profileName = getElement('profile-name');
      if (profileName) {
        profileName.textContent = currentUser.profile.full_name || 'User';
      }
      
      const joinDate = getElement('join-date');
      if (joinDate) {
        joinDate.textContent = currentUser.profile.join_date || 'Jan 2023';
      }
      
      // Show dashboard
      getElement('login-prompt').style.display = 'none';
      getElement('dashboard-container').style.display = 'block';
    }

    // Initialize breathing exercise
    function initBreathingExercise() {
      const cycleCountEl = getElement('cycle-count');
      const timerEl = getElement('timer');
      
      if (cycleCountEl) cycleCountEl.textContent = cycleCount;
      if (timerEl) timerEl.textContent = '0:00';
      
      updateBreathingUI();
    }

    // Start/stop breathing exercise
    function toggleBreathing() {
      const startBtn = getElement('start-breath');
      if (!startBtn) return;
      
      if (!isBreathingActive) {
        startBreathing();
        startBtn.innerHTML = '<i class="fas fa-pause"></i> Pause';
      } else {
        pauseBreathing();
        startBtn.innerHTML = '<i class="fas fa-play"></i> Resume';
      }
      isBreathingActive = !isBreathingActive;
    }

    // Start breathing exercise
    function startBreathing() {
      const breathCircle = document.querySelector('.breath-circle');
      if (breathCircle) breathCircle.classList.add('pulse');
      
      breathInterval = setInterval(() => {
        secondsElapsed++;
        const minutes = Math.floor(secondsElapsed / 60);
        const seconds = secondsElapsed % 60;
        const timerEl = getElement('timer');
        if (timerEl) timerEl.textContent = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
        
        const phaseTime = secondsElapsed % 16;
        let newPhase = currentPhase;
        
        if (phaseTime < 4) newPhase = 0;
        else if (phaseTime < 8) newPhase = 1;
        else if (phaseTime < 12) newPhase = 2;
        else newPhase = 3;
        
        if (newPhase !== currentPhase) {
          currentPhase = newPhase;
          updateBreathingUI();
        }
      }, 1000);
    }

    function updateBreathingUI() {
      const breathText = getElement('breath-text');
      const instruction = getElement('instruction');
      const cycleCountEl = getElement('cycle-count');
      
      const phases = {
        0: { text: 'Breathe In', instruction: 'Breathe in slowly through your nose...', color: 'linear-gradient(135deg, #5E60CE, #64DFDF)' },
        1: { text: 'Hold', instruction: 'Hold your breath...', color: 'linear-gradient(135deg, #64DFDF, #48BB78)' },
        2: { text: 'Breathe Out', instruction: 'Exhale slowly through your mouth...', color: 'linear-gradient(135deg, #48BB78, #FF6B6B)' },
        3: { text: 'Hold', instruction: 'Hold your breath...', color: 'linear-gradient(135deg, #FF6B6B, #5E60CE)' }
      };
      
      const phase = phases[currentPhase] || phases[0];
      
      if (breathText) breathText.textContent = phase.text;
      if (instruction) instruction.textContent = phase.instruction;
      
      const breathCircle = document.querySelector('.breath-circle');
      if (breathCircle) {
        breathCircle.style.background = phase.color;
        breathCircle.style.boxShadow = `0 6px 20px ${phase.color.replace('linear-gradient(135deg, ', '').split(')')[0]}, 0.35)`;
      }
      
      if (currentPhase === 2) {
        cycleCount++;
        if (cycleCountEl) cycleCountEl.textContent = cycleCount;
      }
    }

    // Pause breathing exercise
    function pauseBreathing() {
      clearInterval(breathInterval);
      const breathCircle = document.querySelector('.breath-circle');
      if (breathCircle) breathCircle.classList.remove('pulse');
    }

    // Reset breathing exercise
    function resetBreathing() {
      pauseBreathing();
      isBreathingActive = false;
      cycleCount = 0;
      secondsElapsed = 0;
      currentPhase = 0;
      
      const cycleCountEl = getElement('cycle-count');
      const timerEl = getElement('timer');
      const startBtn = getElement('start-breath');
      
      if (cycleCountEl) cycleCountEl.textContent = cycleCount;
      if (timerEl) timerEl.textContent = '0:00';
      if (startBtn) startBtn.innerHTML = '<i class="fas fa-play"></i> Start';
      
      updateBreathingUI();
    }

    // Set up all event listeners
    function setupEventListeners() {
      // Navigation
      document.querySelectorAll('.nav-item').forEach(item => {
        item.addEventListener('click', function(e) {
          e.preventDefault();
          const target = this.dataset.target;
          
          // Update active nav item
          document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
          this.classList.add('active');
          
          // Show target section
          document.querySelectorAll('.page-section').forEach(section => section.classList.remove('active'));
          const targetSection = getElement(target);
          if (targetSection) targetSection.classList.add('active');
        });
      });
      
      // Go to login button
      const goToLoginBtn = getElement('go-to-login');
      if (goToLoginBtn) {
        goToLoginBtn.addEventListener('click', function() {
          window.location.href = 'login.html';
        });
      }
      
      // Profile avatar click
      const userInitialMobile = getElement('userInitialMobile');
      if (userInitialMobile) {
        userInitialMobile.addEventListener('click', function(e) {
          e.preventDefault();
          // Navigate to profile section
          document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
          const profileNav = document.querySelector('.nav-item[data-target="profile-section"]');
          if (profileNav) profileNav.classList.add('active');
          
          document.querySelectorAll('.page-section').forEach(section => section.classList.remove('active'));
          const profileSection = getElement('profile-section');
          if (profileSection) profileSection.classList.add('active');
        });
      }
      
      // Breathing exercise controls
      const startBtn = getElement('start-breath');
      if (startBtn) startBtn.addEventListener('click', toggleBreathing);
      
      const resetBtn = getElement('reset-breath');
      if (resetBtn) resetBtn.addEventListener('click', resetBreathing);
      
      // Mood selection
      document.querySelectorAll('.mood-option').forEach(option => {
        option.addEventListener('click', function() {
          document.querySelectorAll('.mood-option').forEach(opt => opt.classList.remove('selected'));
          this.classList.add('selected');
          currentMood = this.dataset.mood;
          trackMood();
        });
      });
      
      // Mood history button
      const moodHistoryBtn = getElement('mood-history');
      if (moodHistoryBtn) moodHistoryBtn.addEventListener('click', () => {
        showToast("Mood history feature is coming soon!", "info");
      });
      
      // Chat controls
      const sendBtn = getElement('send-btn');
      if (sendBtn) sendBtn.addEventListener('click', sendMessage);
      
      const chatInput = getElement('chat-input');
      if (chatInput) {
        chatInput.addEventListener('keypress', (e) => {
          if (e.key === 'Enter') sendMessage();
        });
      }
      
      // Chat settings button
      const chatSettingsBtn = getElement('chat-settings');
      if (chatSettingsBtn) {
        chatSettingsBtn.addEventListener('click', () => {
          getElement('companion-modal').style.display = 'flex';
        });
      }
      
      // Memory controls
      const memoryUpload = getElement('memory-upload');
      const memoryFile = getElement('memory-file');
      if (memoryUpload && memoryFile) {
        memoryUpload.addEventListener('click', () => {
          memoryFile.click();
        });
        
        memoryFile.addEventListener('change', function(e) {
          if (this.files && this.files[0]) {
            uploadMemory(this.files[0]);
          }
        });
      }
      
      const memoryBookBtn = getElement('memory-book-btn');
      if (memoryBookBtn) memoryBookBtn.addEventListener('click', () => {
        showMemoryBook();
      });
      
      // Journal controls
      const openJournalBtn = getElement('open-journal');
      if (openJournalBtn) {
        openJournalBtn.addEventListener('click', function(e) {
          e.preventDefault();
          getElement('journal-modal').style.display = 'flex';
        });
      }
      
      const closeJournalModal = getElement('close-journal-modal');
      if (closeJournalModal) {
        closeJournalModal.addEventListener('click', () => {
          getElement('journal-modal').style.display = 'none';
        });
      }
      
      const journalUpload = getElement('journal-upload');
      const journalFile = getElement('journal-file');
      if (journalUpload && journalFile) {
        journalUpload.addEventListener('click', () => {
          journalFile.click();
        });
      }
      
      const saveJournalBtn = getElement('save-journal');
      if (saveJournalBtn) {
        saveJournalBtn.addEventListener('click', saveJournal);
      }
      
      // Account settings controls
      const accountSettingsBtn = getElement('account-settings-btn');
      if (accountSettingsBtn) accountSettingsBtn.addEventListener('click', () => {
        openAccountSettings();
      });
      
      const closeSettingsModal = getElement('close-settings-modal');
      if (closeSettingsModal) {
        closeSettingsModal.addEventListener('click', () => {
          getElement('account-settings-modal').style.display = 'none';
        });
      }
      
      const saveSettingsBtn = getElement('save-settings');
      if (saveSettingsBtn) {
        saveSettingsBtn.addEventListener('click', saveAccountSettings);
      }
      
      // Sign out button
      const signoutBtn = getElement('signout-btn');
      if (signoutBtn) signoutBtn.addEventListener('click', signOut);
      
      // Companion selection buttons
      const changeCompanionBtn = getElement('change-companion-btn');
      if (changeCompanionBtn) changeCompanionBtn.addEventListener('click', () => {
        getElement('companion-modal').style.display = 'flex';
      });
      
      const changeCompanionBtnProfile = getElement('change-companion-btn-profile');
      if (changeCompanionBtnProfile) changeCompanionBtnProfile.addEventListener('click', () => {
        getElement('companion-modal').style.display = 'flex';
      });
      
      // Upgrade button
      const upgradeBtn = getElement('upgrade-btn');
      if (upgradeBtn) upgradeBtn.addEventListener('click', () => {
        upgradeToPremium();
      });
      
      const subscribeBtn = getElement('subscribe-btn');
      if (subscribeBtn) subscribeBtn.addEventListener('click', () => {
        upgradeToPremium();
      });
      
      // Modal close button
      const closeCompanionModal = getElement('close-companion-modal');
      if (closeCompanionModal) {
        closeCompanionModal.addEventListener('click', () => {
          getElement('companion-modal').style.display = 'none';
        });
      }
      
      // Companion selection in modal
      document.querySelectorAll('.companion-select').forEach(select => {
        select.addEventListener('click', function() {
          const companion = this.dataset.companion;
          selectCompanion(companion);
          getElement('companion-modal').style.display = 'none';
        });
      });
      
      // Close memory book modal
      const closeMemoryBookModal = getElement('close-memory-book-modal');
      if (closeMemoryBookModal) {
        closeMemoryBookModal.addEventListener('click', () => {
          getElement('memory-book-modal').style.display = 'none';
        });
      }
    }

    // Show toast notification
    function showToast(message, type = 'success') {
      const toast = getElement('toast');
      if (!toast) return;
      
      toast.textContent = message;
      toast.className = `toast ${type} show`;
      
      setTimeout(() => {
        toast.classList.remove('show');
      }, 3000);
    }

    // Update progress bar
    function updateProgressBar() {
      const totalPoints = progressSources.mood * 1 + progressSources.chat * 2 + 
                         progressSources.journal * 3 + progressSources.memories * 2;
      progress = Math.min(100, Math.round(totalPoints * 100 / 50));
      
      const profileProgressFill = getElement('profile-progress-fill');
      const profileProgressPercent = getElement('profile-progress-percent');
      
      if (profileProgressFill) profileProgressFill.style.width = `${progress}%`;
      if (profileProgressPercent) profileProgressPercent.textContent = `${progress}%`;
      
      // Update progress sources
      const sources = {
        'profile-mood-source': progressSources.mood,
        'profile-chat-source': progressSources.chat,
        'profile-journal-source': progressSources.journal,
        'profile-memory-source': progressSources.memories
      };
      
      Object.entries(sources).forEach(([id, value]) => {
        const el = getElement(id);
        if (el) el.textContent = value;
      });
    }

    // Load companion information
    function loadCompanion() {
      const companion = companions[currentCompanion];
      
      // Update UI
      const nameEl = getElement('companion-name');
      const roleEl = getElement('companion-role');
      const avatarEl = getElement('companion-avatar');
      const specialtiesContainer = getElement('companion-specialties');
      const chatTitle = getElement('chat-title');
      const chatHeaderAvatar = getElement('chat-header-avatar');
      
      if (nameEl) nameEl.textContent = companion.name;
      if (roleEl) roleEl.textContent = companion.role;
      if (avatarEl) avatarEl.innerHTML = `<i class="${companion.avatar}"></i>`;
      if (chatTitle) chatTitle.textContent = `Chat with ${companion.name}`;
      if (chatHeaderAvatar) chatHeaderAvatar.className = companion.avatar;
      
      if (specialtiesContainer) {
        specialtiesContainer.innerHTML = '';
        companion.specialties.forEach(specialty => {
          const tag = document.createElement('div');
          tag.className = 'specialty-tag';
          tag.textContent = specialty;
          specialtiesContainer.appendChild(tag);
        });
      }
    }

    // Select a new companion
    function selectCompanion(companionId) {
      if (!companions[companionId]) return;
      
      currentCompanion = companionId;
      loadCompanion();
      startCompanionChat();
      
      showToast(`Companion changed to ${companions[companionId].name}`, "success");
      
      // In a real app, you would save this preference to the database
      // For demo purposes, we'll just update local state
    }

    // Start chat with companion
    function startCompanionChat() {
      const chatMessages = getElement('chat-messages');
      if (!chatMessages) return;
      
      // Remove loading indicator if present
      const loadingIndicator = getElement('chat-loading');
      if (loadingIndicator) loadingIndicator.remove();
      
      // Reset conversation history
      conversationHistory = [];
      chatMessages.innerHTML = '';
      
      // Add intro message
      const introMessage = document.createElement('div');
      introMessage.className = 'message companion';
      introMessage.innerHTML = `
        ${companions[currentCompanion].intro}
        <div class="message-time">${new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}</div>
      `;
      chatMessages.appendChild(introMessage);
      
      // Add to conversation history
      conversationHistory.push({
        role: "assistant",
        content: companions[currentCompanion].intro
      });
      
      // Add companion change animation
      const chatContainer = getElement('chat-container');
      chatContainer.classList.add('companion-change');
      setTimeout(() => chatContainer.classList.remove('companion-change'), 500);
    }

    // Send message to companion
    function sendMessage() {
      // Check if user has credits or is premium
      if (subscriptionStatus === "free") {
        if (credits < 5) {
          showToast("You don't have enough credits (5 per message)", "error");
          return;
        }
        credits -= 5;
        creditsUsed += 5;
        updateCreditDisplay();
      }
      
      const input = getElement('chat-input');
      if (!input) return;
      
      const message = input.value.trim();
      if (!message) return;
      
      const chatMessages = getElement('chat-messages');
      if (!chatMessages) return;
      
      const now = new Date();
      const timeString = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
      
      // Add user message to UI
      const userMessage = document.createElement('div');
      userMessage.className = 'message user';
      userMessage.innerHTML = `${message}<div class="message-time">${timeString}</div>`;
      chatMessages.appendChild(userMessage);
      
      // Add to conversation history
      conversationHistory.push({
        role: "user",
        content: message
      });
      
      // Clear input
      input.value = '';
      chatMessages.scrollTop = chatMessages.scrollHeight;
      
      // Show thinking indicator
      const thinkingMessage = document.createElement('div');
      thinkingMessage.className = 'message companion';
      thinkingMessage.innerHTML = `<span class="loading-spinner"></span> Thinking...`;
      chatMessages.appendChild(thinkingMessage);
      chatMessages.scrollTop = chatMessages.scrollHeight;
      
      // Simulate AI response with a delay
      setTimeout(() => {
        // Remove thinking indicator
        thinkingMessage.remove();
        
        // Add AI response to UI
        const responseTime = new Date();
        const responseTimeString = responseTime.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        
        // Select a random response from the companion's responses
        const companionResponses = companions[currentCompanion].responses;
        const response = companionResponses[Math.floor(Math.random() * companionResponses.length)];
        
        const companionMessage = document.createElement('div');
        companionMessage.className = 'message companion';
        companionMessage.innerHTML = `${response}<div class="message-time">${responseTimeString}</div>`;
        chatMessages.appendChild(companionMessage);
        
        chatMessages.scrollTop = chatMessages.scrollHeight;
        
        // Add to conversation history
        conversationHistory.push({
          role: "assistant",
          content: response
        });
        
        // Update progress
        progressSources.chat++;
        updateProgressBar();
        
      }, 1500);
    }

    // Upload memory file
    async function uploadMemory(file) {
      if (subscriptionStatus === "free") {
        if (credits < 10) {
          showToast("You need 10 credits to upload a memory", "error");
          return;
        }
        credits -= 10;
        creditsUsed += 10;
        updateCreditDisplay();
      }
      
      showToast(`Uploading "${file.name}"...`, "info");
      
      // Upload to Supabase Storage
      const filePath = `${currentUser.id}/${Date.now()}_${file.name}`;
      const { data, error } = await supabase.storage
        .from('memories')
        .upload(filePath, file);
      
      if (error) {
        showToast("Upload failed: " + error.message, "error");
        return;
      }
      
      // Get public URL
      const { data: urlData } = await supabase.storage
        .from('memories')
        .getPublicUrl(filePath);
      
      const publicUrl = urlData.publicUrl;
      
      // Save memory to database
      const { data: memory, error: dbError } = await supabase
        .from('memories')
        .insert([
          { 
            user_id: currentUser.id, 
            title: file.name, 
            description: "Uploaded memory",
            file_url: publicUrl,
            file_type: file.type
          }
        ]);
      
      if (dbError) {
        showToast("Failed to save memory: " + dbError.message, "error");
        return;
      }
      
      showToast("Memory uploaded successfully!", "success");
      
      // Update UI
      loadMemories();
      
      // Update progress
      progressSources.memories++;
      updateProgressBar();
    }

    // Save journal entry
    function saveJournal() {
      const title = getElement('journal-title').value.trim();
      const content = getElement('journal-content').value.trim();
      const fileInput = getElement('journal-file');
      
      if (!title || !content) {
        showToast("Please fill in both title and content", "error");
        return;
      }
      
      // Check for attachment
      let hasAttachment = false;
      if (fileInput.files && fileInput.files[0]) {
        hasAttachment = true;
        
        if (subscriptionStatus === "free") {
          if (credits < 5) {
            showToast("You need 5 credits to add an attachment", "error");
            return;
          }
          credits -= 5;
          creditsUsed += 5;
          updateCreditDisplay();
        }
      }
      
      // Simulate save process
      showToast("Saving journal entry...", "info");
      
      setTimeout(() => {
        showToast("Journal entry saved successfully!", "success");
        getElement('journal-modal').style.display = 'none';
        
        // Reset form
        getElement('journal-title').value = '';
        getElement('journal-content').value = '';
        fileInput.value = '';
        
        // Update progress
        progressSources.journal++;
        updateProgressBar();
      }, 1500);
    }

    // Upgrade to premium
    function upgradeToPremium() {
      // Redirect to pricing page
      window.location.href = 'pricing.html';
    }

    // Load memories from Supabase
    async function loadMemories() {
      const container = getElement('memory-container');
      if (!container) return;
      
      // Remove loading indicator
      const loadingIndicator = getElement('memories-loading');
      if (loadingIndicator) loadingIndicator.remove();
      
      // Show loading state
      container.innerHTML = '<div class="loading-text"><div class="loading-spinner"></div> Loading your memories...</div>';
      
      try {
        // Fetch memories from Supabase
        const { data: memories, error } = await supabase
          .from('memories')
          .select('*')
          .eq('user_id', currentUser.id);
        
        if (error) throw error;
        
        // Update progress sources
        progressSources.memories = memories.length;
        updateProgressBar();
        
        // Update UI
        container.innerHTML = '';
        
        // Add existing memories
        memories.forEach(memory => {
          const memoryItem = document.createElement('div');
          memoryItem.className = 'memory-item has-image';
          memoryItem.style.backgroundImage = `url(${memory.file_url})`;
          memoryItem.innerHTML = `
            <div class="memory-label">${memory.title}</div>
          `;
          
          memoryItem.addEventListener('click', () => {
            showToast(`Viewing memory: ${memory.title}`, "info");
          });
          container.appendChild(memoryItem);
        });
        
        // Add "Add Memory" button
        const addMemory = document.createElement('div');
        addMemory.className = 'memory-item add-memory';
        addMemory.innerHTML = `
          <i class="fas fa-plus"></i>
          <div class="memory-label">Add Memory</div>
        `;
        addMemory.addEventListener('click', () => {
          getElement('memory-file').click();
        });
        container.appendChild(addMemory);
        
      } catch (error) {
        container.innerHTML = '<div class="empty-state">Failed to load memories</div>';
        console.error("Error loading memories:", error);
      }
    }

    // Show memory book
    async function showMemoryBook() {
      const modal = getElement('memory-book-modal');
      const content = getElement('memory-book-content');
      
      if (!modal || !content) return;
      
      // Show loading state
      content.innerHTML = '<div class="loading-text"><div class="loading-spinner"></div> Loading your memories...</div>';
      modal.style.display = 'flex';
      
      try {
        // Fetch memories from Supabase
        const { data: memories, error } = await supabase
          .from('memories')
          .select('*')
          .eq('user_id', currentUser.id);
        
        if (error) throw error;
        
        content.innerHTML = '';
        
        memories.forEach(memory => {
          const entry = document.createElement('div');
          entry.className = 'memory-book-entry';
          entry.innerHTML = `
            <div class="memory-book-thumbnail" style="background-image: url(${memory.file_url})">
            </div>
            <div class="memory-book-details">
              <div class="memory-book-title">${memory.title}</div>
              <div class="memory-book-date">Added: ${new Date(memory.created_at).toLocaleDateString()}</div>
            </div>
          `;
          content.appendChild(entry);
        });
        
        if (memories.length === 0) {
          content.innerHTML = '<div class="empty-state">No memories found. Start adding some!</div>';
        }
      } catch (error) {
        content.innerHTML = '<div class="empty-state">Failed to load memory book</div>';
        console.error("Error loading memory book:", error);
      }
    }

    // Open account settings
    function openAccountSettings() {
      const modal = getElement('account-settings-modal');
      if (!modal) return;
      
      // Populate with current user data
      getElement('settings-name').value = currentUser.profile.full_name || '';
      getElement('settings-email').value = currentUser.email || '';
      
      modal.style.display = 'flex';
    }

    // Save account settings
    function saveAccountSettings() {
      const name = getElement('settings-name').value;
      const email = getElement('settings-email').value;
      const password = getElement('settings-password').value;
      const confirm = getElement('settings-confirm').value;
      
      // Validate password if changed
      if (password || confirm) {
        if (password !== confirm) {
          showToast("Passwords don't match", "error");
          return;
        }
        if (password.length < 6) {
          showToast("Password must be at least 6 characters", "error");
          return;
        }
      }
      
      showToast("Saving account settings...", "info");
      
      setTimeout(() => {
        // Update profile name
        currentUser.profile.full_name = name;
        
        // Update UI
        const userInitials = name.split(' ').map(n => n[0]).join('').toUpperCase() || 'U';
        ['userInitialTextMobile', 'profile-initial'].forEach(id => {
          const el = getElement(id);
          if (el) el.textContent = userInitials;
        });
        
        const profileName = getElement('profile-name');
        if (profileName) {
          profileName.textContent = name;
        }
        
        showToast("Account settings updated successfully", "success");
        getElement('account-settings-modal').style.display = 'none';
      }, 1000);
    }

    // Sign out user
    async function signOut() {
      const { error } = await supabase.auth.signOut();
      if (error) {
        showToast("Error signing out: " + error.message, "error");
      } else {
        showToast("Signed out successfully", "success");
        setTimeout(() => {
          window.location.reload();
        }, 1500);
      }
    }
    
    // Track mood function
    function trackMood() {
      progressSources.mood++;
      updateProgressBar();
      showToast(`Your mood has been recorded: ${currentMood}`, "success");
    }
  </script>
</body>
</html>
